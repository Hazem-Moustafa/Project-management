<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PMT: XmlNavBar.ascx.cs Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.1 -->
<h1>XmlNavBar.ascx.cs</h1><div class="fragment"><pre>00001 <span class="keyword">using</span> System;
00002 <span class="keyword">using</span> System.Data;
00003 <span class="keyword">using</span> System.Web;
00004 <span class="keyword">using</span> System.Web.UI.WebControls;
00005 <span class="keyword">using</span> System.Web.UI.HtmlControls;
00006 <span class="keyword">using</span> System.Text;
00007 <span class="keyword">using</span> System.Web.Security;
00008 <span class="keyword">using</span> PMTComponents;
00009 
00010 <span class="keyword">namespace </span>PMT.Controls
00011 {
<a name="l00015"></a><a class="code" href="classPMT_1_1Controls_1_1XmlNavBar.html">00015</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classPMT_1_1Controls_1_1XmlNavBar.html">XmlNavBar</a> : System.Web.UI.UserControl
00016     {
00017         <span class="keyword">protected</span> System.Web.UI.WebControls.Table navTable;
00018 
00019         <span class="keyword">private</span> <span class="keywordtype">void</span> Page_Load(object sender, System.EventArgs e)
00020         {
00021             <span class="comment">// if the users is logged in, add a logged in links</span>
00022             <span class="comment">// else add a login and register links</span>
00023             <span class="keywordflow">if</span>(Context.User.Identity.IsAuthenticated)
00024             {
00025                 string appPath = Request.ApplicationPath;
00026                 string xmlFile = <span class="stringliteral">"NavLinks.xml"</span>;
00027                
00028                 <span class="keywordflow">if</span> (Request.Cookies[<span class="stringliteral">"user"</span>][<span class="stringliteral">"role"</span>].Equals(PMTUserRole.Manager.ToString()))
00029                     loadXmlLinks(appPath+<span class="stringliteral">"/PM/"</span>+xmlFile);
00030                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Request.Cookies[<span class="stringliteral">"user"</span>][<span class="stringliteral">"role"</span>].Equals(PMTUserRole.Developer.ToString()))
00031                     loadXmlLinks(appPath+<span class="stringliteral">"/Dev/"</span>+xmlFile);
00032                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Request.Cookies[<span class="stringliteral">"user"</span>][<span class="stringliteral">"role"</span>].Equals(PMTUserRole.Administrator.ToString()))
00033                 {
00034                     loadXmlLinks(appPath+<span class="stringliteral">"/Admin/"</span>+xmlFile);
00035                     loadXmlLinks(appPath+<span class="stringliteral">"/PM/"</span>+xmlFile);
00036                 }
00037                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (Request.Cookies[<span class="stringliteral">"user"</span>][<span class="stringliteral">"role"</span>].Equals(PMTUserRole.Client.ToString()))
00038                     loadXmlLinks(appPath+<span class="stringliteral">"/Client/"</span>+xmlFile);
00039 
00040                 addLink(<span class="stringliteral">"Reports"</span>, <span class="stringliteral">"AllUsers/Reports.aspx"</span>);
00041                 addLink(<span class="stringliteral">"Profile"</span>, <span class="stringliteral">"AllUsers/Profile.aspx"</span>);
00042                 addLink(<span class="stringliteral">"Messaging"</span>, <span class="stringliteral">"AllUsers/Msg/"</span>);
00043                 addLink(<span class="stringliteral">"Logout"</span>, <span class="stringliteral">"Logout.aspx"</span>);
00044             }
00045             <span class="keywordflow">else</span>
00046             {
00047                 addLink(<span class="stringliteral">"Login"</span>, <span class="stringliteral">"Login.aspx"</span>);
00048                 addLink(<span class="stringliteral">"Register"</span>, <span class="stringliteral">"Register.aspx"</span>);
00049             }
00050         }
00051 
00052 <span class="preprocessor">        #region Web Form Designer generated code</span>
00053 <span class="preprocessor"></span>        override <span class="keyword">protected</span> <span class="keywordtype">void</span> OnInit(EventArgs e)
00054         {
00055             <span class="comment">//</span>
00056             <span class="comment">// CODEGEN: This call is required by the ASP.NET Web Form Designer.</span>
00057             <span class="comment">//</span>
00058             InitializeComponent();
00059             base.OnInit(e);
00060         }
00061         
<a name="l00066"></a><a class="code" href="classPMT_1_1Controls_1_1XmlNavBar.html#PMT_1_1Controls_1_1XmlNavBard1">00066</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> InitializeComponent()
00067         {
00068             <span class="keyword">this</span>.Load += <span class="keyword">new</span> System.EventHandler(<span class="keyword">this</span>.Page_Load);
00069 
00070         }
00071 <span class="preprocessor">        #endregion</span>
00072 <span class="preprocessor"></span>
00073 
<a name="l00078"></a><a class="code" href="classPMT_1_1Controls_1_1XmlNavBar.html#PMT_1_1Controls_1_1XmlNavBard2">00078</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> loadXmlLinks(string xmlFile)
00079         {
00080             DataSet ds = <span class="keyword">new</span> DataSet();
00081             ds.ReadXml(Server.MapPath(xmlFile));
00082 
00083             <span class="keywordflow">if</span> (ds.Tables.Count &gt; 0)
00084             {
00085                 foreach(DataRow item in ds.Tables[0].Rows)
00086                 {
00087                     addLink(item[<span class="stringliteral">"Text"</span>].ToString(), item[<span class="stringliteral">"Link"</span>].ToString());
00088                 }
00089             }
00090             addBreak();
00091         }
00092 
<a name="l00099"></a><a class="code" href="classPMT_1_1Controls_1_1XmlNavBar.html#PMT_1_1Controls_1_1XmlNavBara0">00099</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> addLink(string linkTitle, string linkSource)
00100         {
00101             TableRow  row = <span class="keyword">new</span> TableRow();
00102             TableCell cell = <span class="keyword">new</span> TableCell();
00103             StringBuilder sb = <span class="keyword">new</span> StringBuilder();
00104 
00105             sb.Append(<span class="stringliteral">"&lt;a href=\""</span>);
00106             sb.Append(Request.ApplicationPath);
00107             sb.Append(<span class="stringliteral">"/"</span>);
00108             sb.Append(linkSource);
00109             sb.Append(<span class="stringliteral">"\" class=\"nav\"&gt;"</span>);
00110             sb.Append(linkTitle);
00111             sb.Append(<span class="stringliteral">"&lt;/a&gt;"</span>);
00112             
00113             cell.Text = sb.ToString();
00114             row.Cells.Add(cell);
00115             navTable.Rows.Add(row); 
00116         }
00117 
<a name="l00121"></a><a class="code" href="classPMT_1_1Controls_1_1XmlNavBar.html#PMT_1_1Controls_1_1XmlNavBara1">00121</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> addBreak()
00122         {
00123             TableRow  row = <span class="keyword">new</span> TableRow();
00124             TableCell cell = <span class="keyword">new</span> TableCell();
00125             cell.Text = <span class="stringliteral">"&amp;nbsp;"</span>;
00126             row.Cells.Add(cell);
00127             navTable.Rows.Add(row);
00128         }
00129     }
00130 }
</pre></div><hr><address style="align: right;"><small>
Generated on Sun Aug 6 23:06:03 2006 for PMT by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.1 using KingsTools</small></address>
</body>
</html>

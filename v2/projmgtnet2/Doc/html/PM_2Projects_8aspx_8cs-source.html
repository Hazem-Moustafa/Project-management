<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PMT: D:/My Documents/Visual Studio Projects/projmgtnet2/PM/Projects.aspx.cs Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.1 -->
<h1>D:/My Documents/Visual Studio Projects/projmgtnet2/PM/Projects.aspx.cs</h1><div class="fragment"><pre>00001 <span class="keyword">using</span> System;
00002 <span class="keyword">using</span> System.Collections;
00003 <span class="keyword">using</span> System.ComponentModel;
00004 <span class="keyword">using</span> System.Data;
00005 <span class="keyword">using</span> System.Data.SqlClient;
00006 <span class="keyword">using</span> System.Drawing;
00007 <span class="keyword">using</span> System.Web;
00008 <span class="keyword">using</span> System.Web.SessionState;
00009 <span class="keyword">using</span> System.Web.UI;
00010 <span class="keyword">using</span> System.Web.UI.WebControls;
00011 <span class="keyword">using</span> System.Web.UI.HtmlControls;
00012 <span class="keyword">using</span> PMTComponents;
00013 
00014 <span class="keyword">namespace </span>PMT.PM
00015 {
<a name="l00019"></a><a class="code" href="classPMT_1_1PM_1_1Projects.html">00019</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classPMT_1_1PM_1_1Projects.html">Projects</a> : System.Web.UI.Page
00020     {
00021         <span class="keyword">protected</span> System.Web.UI.WebControls.HyperLink newProjectLink;
00022         <span class="keyword">protected</span> System.Web.UI.WebControls.Panel projectPanel;
00023         <span class="keyword">protected</span> string itemType;
00024         <span class="keyword">protected</span> System.Web.UI.WebControls.HyperLink AddItemHyperLink;
00025         <span class="keyword">protected</span> System.Web.UI.WebControls.DataGrid DataGrid1;
00026         <span class="keyword">protected</span> System.Web.UI.WebControls.Label ItemLabel;
00027         <span class="keyword">protected</span> string id;
00028     
00029         <span class="keyword">private</span> <span class="keywordtype">void</span> Page_Load(object sender, System.EventArgs e)
00030         {
00031             <span class="comment">// Put user code to initialize the page here</span>
00032 
00033             <span class="comment">// the item type and id</span>
00034             itemType = Request[<span class="stringliteral">"item"</span>];
00035             id   = Request[<span class="stringliteral">"id"</span>];
00036 
00037             <span class="comment">// default to displaying projects</span>
00038             <span class="keywordflow">if</span> (itemType == null)
00039                 itemType = ProjectItem.ItemType.PROJECT;
00040 
00041             <span class="comment">// the project item to display</span>
00042             ProjectItem item;
00043 
00044             <span class="comment">// id is the project manager's id if item is project</span>
00045             <span class="keywordflow">if</span> (itemType.Equals(ProjectItem.ItemType.PROJECT))
00046                 id = Request.Cookies[<span class="stringliteral">"user"</span>][<span class="stringliteral">"id"</span>];
00047             
00048             <span class="comment">//create a data set</span>
00049             DataSet ds=<span class="keyword">new</span> DataSet();
00050 
00051             <span class="comment">// list all projects assigned to logged in PM</span>
00052             <span class="keywordflow">if</span> (itemType.Equals(ProjectItem.ItemType.PROJECT))
00053             {
00054                 ds = Project.getProjectsDataSet(id);
00055                 item = null;
00056             }
00057                 <span class="comment">// list all modules in specified project</span>
00058             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (itemType.Equals(ProjectItem.ItemType.MODULE))
00059             {
00060                 item = <span class="keyword">new</span> Project(id);
00061                 ds = ((Project)item).getModulesDataSet();
00062             }
00063                 <span class="comment">// list all tasks in specified module</span>
00064             <span class="keywordflow">else</span> <span class="comment">//if (itemType.Equals(ProjectItemType.TASK))</span>
00065             {
00066                 item = <span class="keyword">new</span> Module(id);
00067                 ds = ((Module)item).getTasksDataSet();
00068                 BoundColumn ComplexityColumn = <span class="keyword">new</span> BoundColumn();
00069                 ComplexityColumn.HeaderText = <span class="stringliteral">"Complexity"</span>;
00070                 ComplexityColumn.DataField = <span class="stringliteral">"complexity"</span>;
00071                 ComplexityColumn.ReadOnly = <span class="keyword">true</span>;
00072                 DataGrid1.Columns.AddAt(3, ComplexityColumn);
00073             }
00074 
00075             <span class="comment">// set the display grid data source</span>
00076             setDisplayItemType();
00077             DataGrid1.DataSource = ds;
00078             <span class="keywordflow">if</span> (!Page.IsPostBack)
00079             {
00080                 DataGrid1.DataBind();
00081             }
00082 
00083             <span class="comment">// set the create/add new item link and item label</span>
00084             <span class="keywordflow">if</span> (item != null)
00085             {
00086                 AddItemHyperLink.NavigateUrl 
00087                     = <span class="stringliteral">"NewItem.aspx?item="</span> + itemType + <span class="stringliteral">"&amp;parentID="</span> + item.ID;
00088                 AddItemHyperLink.Text = <span class="stringliteral">"Add a "</span> + itemType + <span class="stringliteral">" to "</span> + item.Name;
00089                 ItemLabel.Text = itemType +<span class="stringliteral">"s in "</span> + item.Name;
00090             }
00091             <span class="keywordflow">else</span>
00092             {
00093                 AddItemHyperLink.NavigateUrl = <span class="stringliteral">"NewItem.aspx?item=Project"</span>;
00094                 AddItemHyperLink.Text = <span class="stringliteral">"Create a new project"</span>;
00095                 ItemLabel.Text = <span class="stringliteral">"Your projects"</span>;
00096             }
00097         }
00098 
00099 <span class="preprocessor">        #region Web Form Designer generated code</span>
00100 <span class="preprocessor"></span>        override <span class="keyword">protected</span> <span class="keywordtype">void</span> OnInit(EventArgs e)
00101         {
00102             <span class="comment">//</span>
00103             <span class="comment">// CODEGEN: This call is required by the ASP.NET Web Form Designer.</span>
00104             <span class="comment">//</span>
00105             InitializeComponent();
00106             base.OnInit(e);
00107         }
00108         
<a name="l00113"></a><a class="code" href="classPMT_1_1PM_1_1Projects.html#PMT_1_1PM_1_1Projectsd1">00113</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> InitializeComponent()
00114         {    
00115             <span class="keyword">this</span>.DataGrid1.CancelCommand += <span class="keyword">new</span> System.Web.UI.WebControls.DataGridCommandEventHandler(<span class="keyword">this</span>.CancelCommand_Clicked);
00116             <span class="keyword">this</span>.DataGrid1.EditCommand += <span class="keyword">new</span> System.Web.UI.WebControls.DataGridCommandEventHandler(<span class="keyword">this</span>.EditButton_Pushed);
00117             <span class="keyword">this</span>.DataGrid1.UpdateCommand += <span class="keyword">new</span> System.Web.UI.WebControls.DataGridCommandEventHandler(<span class="keyword">this</span>.UpdateCommand_Pushed);
00118             <span class="keyword">this</span>.DataGrid1.DeleteCommand += <span class="keyword">new</span> System.Web.UI.WebControls.DataGridCommandEventHandler(<span class="keyword">this</span>.DeleteButton_Pushed);
00119             <span class="keyword">this</span>.Load += <span class="keyword">new</span> System.EventHandler(<span class="keyword">this</span>.Page_Load);
00120 
00121         }
00122 <span class="preprocessor">        #endregion</span>
00123 <span class="preprocessor"></span>
<a name="l00127"></a><a class="code" href="classPMT_1_1PM_1_1Projects.html#PMT_1_1PM_1_1Projectsd2">00127</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> DeleteButton_Pushed(object source, System.Web.UI.WebControls.DataGridCommandEventArgs e)
00128         {
00129             string delID = DataGrid1.Items[e.Item.ItemIndex].Cells[0].Text;
00130 
00131             <span class="keywordflow">if</span> (itemType.Equals(ProjectItem.ItemType.PROJECT))
00132                 Project.remove(delID);
00133             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (itemType.Equals(ProjectItem.ItemType.MODULE))
00134                 Module.remove(delID);
00135             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (itemType.Equals(ProjectItem.ItemType.TASK))
00136                 Task.remove(delID);
00137 
00138             Response.Redirect(Request.Url.PathAndQuery);
00139         }
00140 
<a name="l00144"></a><a class="code" href="classPMT_1_1PM_1_1Projects.html#PMT_1_1PM_1_1Projectsd3">00144</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> setDisplayItemType()
00145         {
00146             <span class="comment">// change the name column to a BoundColumn instead of a HypLinkColumn</span>
00147             <span class="keywordflow">if</span> (itemType.Equals(ProjectItem.ItemType.TASK))
00148             {
00149                 <span class="comment">// set the link url for the name column</span>
00150                 ((HyperLinkColumn)DataGrid1.Columns[1]).DataNavigateUrlFormatString = <span class="stringliteral">"Assign.aspx?taskID={0}"</span>;
00151                 DataGrid1.Columns[1].HeaderText = itemType + <span class="stringliteral">" Name (Click to assign)"</span>;
00152 
00153                 <span class="keywordflow">return</span>;
00154             }
00155 
00156             string item = <span class="stringliteral">""</span>;
00157 
00158             <span class="comment">// set item type to be displayed</span>
00159             <span class="keywordflow">if</span> (itemType.Equals(ProjectItem.ItemType.PROJECT))
00160                 item = ProjectItem.ItemType.MODULE;
00161             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(itemType.Equals(ProjectItem.ItemType.MODULE))
00162                 item = ProjectItem.ItemType.TASK;
00163 
00164             <span class="comment">// set the link url for the name column</span>
00165             ((HyperLinkColumn)DataGrid1.Columns[1]).DataNavigateUrlFormatString = <span class="stringliteral">"Projects.aspx?item="</span>+item+<span class="stringliteral">"&amp;id={0}"</span>;
00166             DataGrid1.Columns[1].HeaderText = itemType + <span class="stringliteral">" Name"</span>;
00167         }
00168 
<a name="l00172"></a><a class="code" href="classPMT_1_1PM_1_1Projects.html#PMT_1_1PM_1_1Projectsd4">00172</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> EditButton_Pushed(object source, System.Web.UI.WebControls.DataGridCommandEventArgs e)
00173         {
00174             DataGrid1.EditItemIndex=e.Item.ItemIndex;
00175             DataGrid1.DataBind();
00176         }
00177 
00178         <span class="keyword">private</span> <span class="keywordtype">void</span> UpdateCommand_Pushed(object source, System.Web.UI.WebControls.DataGridCommandEventArgs e)
00179         {
00180             TextBox tb;
00181             string name = ((HyperLink)e.Item.Cells[1].Controls[0]).Text;
00182             tb = (TextBox)e.Item.Cells[2].Controls[0];
00183             string desc = tb.Text;
00184             tb = (TextBox)e.Item.Cells[3].Controls[0];
00185             string start = tb.Text;
00186 
00187             string id = DataGrid1.Items[e.Item.ItemIndex].Cells[0].Text;
00188 
00189             
00190             ProjectItem item;
00191 
00192             <span class="keywordflow">if</span>(itemType.Equals(ProjectItem.ItemType.PROJECT))
00193             {
00194                 item = <span class="keyword">new</span> Project(id);
00195                 ((Project)item).update(name, desc, start);
00196             }
00197             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (itemType.Equals(ProjectItem.ItemType.MODULE))
00198             {
00199                 item = <span class="keyword">new</span> Module(id);
00200                 ((Module)item).update(name, desc, start);
00201             }
00202             <span class="keywordflow">else</span> <span class="comment">//if (itemType.Equals(ProjectItem.ItemType.TASK))</span>
00203             {
00204                 item = <span class="keyword">new</span> Task(id);
00205                 ((Task)item).update(name, desc, start);
00206             }
00207 
00208             item.update(name, desc, start);
00209 
00210             DataGrid1.EditItemIndex=-1;
00211             Server.Transfer(Request.Url.AbsolutePath);
00212         }
00213 
00214         <span class="keyword">private</span> <span class="keywordtype">void</span> CancelCommand_Clicked(object source, System.Web.UI.WebControls.DataGridCommandEventArgs e)
00215         {
00216             DataGrid1.EditItemIndex=-1;
00217             Server.Transfer(Request.Url.AbsolutePath);
00218         }
00219     }
00220 }
</pre></div><hr><address style="align: right;"><small>
Generated on Sat Aug 5 14:40:47 2006 for PMT by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.1 using KingsTools</small></address>
</body>
</html>

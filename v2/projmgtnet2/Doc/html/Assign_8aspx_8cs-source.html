<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PMT: D:/My Documents/Visual Studio Projects/projmgtnet2/PM/Assign.aspx.cs Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.1 -->
<h1>D:/My Documents/Visual Studio Projects/projmgtnet2/PM/Assign.aspx.cs</h1><div class="fragment"><pre>00001 <span class="keyword">using</span> System;
00002 <span class="keyword">using</span> System.Collections;
00003 <span class="keyword">using</span> System.ComponentModel;
00004 <span class="keyword">using</span> System.Data;
00005 <span class="keyword">using</span> System.Drawing;
00006 <span class="keyword">using</span> System.Web;
00007 <span class="keyword">using</span> System.Web.SessionState;
00008 <span class="keyword">using</span> System.Web.UI;
00009 <span class="keyword">using</span> System.Web.UI.WebControls;
00010 <span class="keyword">using</span> System.Web.UI.HtmlControls;
00011 <span class="keyword">using</span> PMTComponents;
00012 
00013 <span class="keyword">namespace </span>PMT.PM
00014 {
<a name="l00018"></a><a class="code" href="classPMT_1_1PM_1_1Assign.html">00018</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classPMT_1_1PM_1_1Assign.html">Assign</a> : System.Web.UI.Page
00019     {
00020         <span class="keyword">protected</span> System.Web.UI.WebControls.Label AvailDevLabel;
00021         <span class="keyword">protected</span> System.Web.UI.WebControls.DataGrid DataGrid2;
00022         <span class="keyword">protected</span> System.Web.UI.WebControls.Panel AvailableDevPanel;
00023         <span class="keyword">protected</span> System.Web.UI.WebControls.Panel AssignmentsPanel;
00024         <span class="keyword">protected</span> System.Web.UI.WebControls.Button UpdateButton;
00025         <span class="keyword">protected</span> System.Web.UI.WebControls.Button CommitButton;
00026         <span class="keyword">protected</span> System.Web.UI.WebControls.Button CancelButton;
00027         <span class="keyword">protected</span> System.Web.UI.WebControls.Label ErrorLabel;
00028         <span class="keyword">protected</span> System.Web.UI.WebControls.TextBox ThresholdTextBox;
00029         <span class="keyword">protected</span> System.Web.UI.WebControls.RegularExpressionValidator ThreshholdTextBoxRegularExpressionValidator;
00030         <span class="keyword">protected</span> System.Web.UI.WebControls.DataGrid DataGrid1;
00031 
00032     
00033         <span class="keyword">private</span> <span class="keywordtype">void</span> Page_Load(object sender, System.EventArgs e)
00034         {
00035             <span class="comment">// Put user code to initialize the page here</span>
00036             string taskID = Request[<span class="stringliteral">"taskID"</span>];
00037             string error = Request[<span class="stringliteral">"error"</span>];
00038 
00039             <span class="keywordflow">if</span> (error != null)
00040             {
00041                 <span class="comment">//Response.Write("&lt;script type=\"text/javascript\"&gt;alert(\""+ error +"\");&lt;/script&gt;");</span>
00042                 ErrorLabel.Text = error;
00043             }
00044 
00045             <span class="keywordflow">if</span> (taskID != null)
00046                 AvailDevLabel.Text = <span class="stringliteral">"Choose Developer to be assigned to Task "</span> + taskID;
00047 
00048             <span class="comment">// fill available developers data grid</span>
00049             <span class="comment">//TODO: FINISH THIS</span>
00050 
00051 <span class="comment">//          int Threshold = Convert.ToInt32(ThresholdTextBox.Text);</span>
00052 
00053             <a class="code" href="classPMT_1_1DBDriver.html">DBDriver</a> myDB = <span class="keyword">new</span> <a class="code" href="classPMT_1_1DBDriver.html">DBDriver</a>();
00054             string s = <span class="stringliteral">"select p.ID as ID, p.lastName as lastName, p.firstName as firstName,\n"</span>
00055                 + <span class="stringliteral">"u.username as username, c.competence as competence, count(a.devID) as taskCount\n"</span>
00056                 + <span class="stringliteral">"from person p, compLevels c, assignments a, users u\n"</span>
00057                 + <span class="stringliteral">"where p.ID = u.ID\n"</span>
00058                 + <span class="stringliteral">"and u.security = 'Developer'\n"</span>
00059                 + <span class="stringliteral">"and p.ID = a.devID\n"</span>
00060                 + <span class="stringliteral">"and p.ID = c.ID\n"</span>
00061                 + <span class="stringliteral">"group by p.ID, p.lastName, p.firstName, u.userName, c.competence\n"</span>
00062                 + <span class="stringliteral">"having count(a.devID) &lt; 10"</span>  <span class="comment">// set to 10 for testing</span>
00063                 + <span class="stringliteral">"order by p.lastName;"</span>;
00064 
00065 
00066 <span class="comment">//              if(Threshold != -1 )</span>
00067 <span class="comment">//                  s +="having count(a.devID) &lt; @Threshold";</span>
00068 <span class="comment">//</span>
00069 <span class="comment">//                    s += "order by p.lastName;";</span>
00070 
00071             myDB.<a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDriver00">Query</a> = s;
00072 <span class="comment">//          if( Threshold != -1 )</span>
00073 <span class="comment">//              myDB.addParam( "@Threshold", Threshold );</span>
00074 
00075             
00076             DataSet ds = <span class="keyword">new</span> DataSet();
00077             myDB.<a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera2">createAdapter</a>().Fill(ds);
00078             DataGrid1.DataSource = ds;
00079             DataGrid1.DataBind();
00080 
00081             <span class="comment">// fill assignments data grid</span>
00082             DBDriver myDB2 = <span class="keyword">new</span> DBDriver();
00083             s = <span class="stringliteral">"select assignments.taskID as taskID, users.ID as devID, users.username as username, tasks.name as taskName, \n"</span>
00084                 + <span class="stringliteral">"modules.name as moduleName, projects.name as projectName, assignments.dateAss as date, tasks.complete as complete\n"</span>
00085                 + <span class="stringliteral">"from assignments, users, tasks, modules, projects\n"</span>
00086                 + <span class="stringliteral">"where users.ID = assignments.devID\n"</span>
00087                 + <span class="stringliteral">"and users.security = 'Developer'\n"</span>
00088                 + <span class="stringliteral">"and assignments.taskID = tasks.ID\n"</span>
00089                 + <span class="stringliteral">"and tasks.moduleID = modules.ID\n"</span>
00090                 + <span class="stringliteral">"and modules.projectID = projects.ID\n"</span>
00091                 + <span class="stringliteral">"and projects.managerID = @mgrID \n"</span>
00092                 + <span class="stringliteral">"order by projects.name, modules.name, tasks.name, users.username;"</span>;
00093 
00094             myDB2.<a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDriver00">Query</a> = s;
00095             myDB2.<a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera6">addParam</a>(<span class="stringliteral">"@mgrID"</span>, Request.Cookies[<span class="stringliteral">"user"</span>][<span class="stringliteral">"id"</span>]);
00096             DataSet ads = <span class="keyword">new</span> DataSet();
00097             myDB2.<a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera2">createAdapter</a>().Fill(ads);
00098             DataGrid2.DataSource = ads;
00099             <span class="keywordflow">if</span>( !Page.IsPostBack )
00100                 DataGrid2.DataBind();
00101 
00102         }
00103 
00104 <span class="preprocessor">        #region Web Form Designer generated code</span>
00105 <span class="preprocessor"></span>        override <span class="keyword">protected</span> <span class="keywordtype">void</span> OnInit(EventArgs e)
00106         {
00107             <span class="comment">//</span>
00108             <span class="comment">// CODEGEN: This call is required by the ASP.NET Web Form Designer.</span>
00109             <span class="comment">//</span>
00110             InitializeComponent();
00111             base.OnInit(e);
00112         }
00113         
<a name="l00118"></a><a class="code" href="classPMT_1_1PM_1_1Assign.html#PMT_1_1PM_1_1Assignd1">00118</a>         <span class="keyword">private</span> <span class="keywordtype">void</span> InitializeComponent()
00119         {    
00120             <span class="keyword">this</span>.DataGrid1.ItemCommand += <span class="keyword">new</span> System.Web.UI.WebControls.DataGridCommandEventHandler(<span class="keyword">this</span>.Username_Click);
00121             <span class="keyword">this</span>.UpdateButton.Click += <span class="keyword">new</span> System.EventHandler(<span class="keyword">this</span>.UpdateButton_Click);
00122             <span class="keyword">this</span>.CommitButton.Click += <span class="keyword">new</span> System.EventHandler(<span class="keyword">this</span>.CommitButton_Click);
00123             <span class="keyword">this</span>.CancelButton.Click += <span class="keyword">new</span> System.EventHandler(<span class="keyword">this</span>.CancelButton_Click);
00124             <span class="keyword">this</span>.Load += <span class="keyword">new</span> System.EventHandler(<span class="keyword">this</span>.Page_Load);
00125 
00126         }
00127 <span class="preprocessor">        #endregion</span>
00128 <span class="preprocessor"></span>
00129 
00130         <span class="keyword">private</span> <span class="keywordtype">void</span> Username_Click(object source, System.Web.UI.WebControls.DataGridCommandEventArgs e)
00131         {
00132             string taskID = Request[<span class="stringliteral">"taskID"</span>];
00133 
00134             <span class="comment">// get the developer ID</span>
00135             string devID = DataGrid1.Items[e.Item.ItemIndex].Cells[0].Text;
00136 
00137             <span class="comment">// if the taskID is not defined, goto Dev Profile</span>
00138             <span class="keywordflow">if</span> (taskID == null)
00139             {
00140                 Response.Redirect(<span class="stringliteral">"ViewDevProfile.aspx?devID="</span>+devID);
00141                 <span class="keywordflow">return</span>;
00142             }
00143 
00144             <span class="comment">// assign the developer to the selected task</span>
00145             Task task = <span class="keyword">new</span> Task(taskID);
00146             <span class="keywordflow">if</span> ( task.DeveloperID == null )
00147             {
00148                 task.assignDeveloper(devID);
00149                 Response.Redirect(Request.Url.AbsolutePath);
00150             }
00151             <span class="keywordflow">else</span>
00152             {
00153                 string error = <span class="stringliteral">"'"</span> + task.Name + <span class="stringliteral">"' has already been assigned."</span>;
00154                 Response.Redirect(Request.Url.AbsolutePath+<span class="stringliteral">"?error="</span>+error);
00155             }
00156         }
00157 
00158         <span class="keyword">private</span> <span class="keywordtype">void</span> UpdateButton_Click(object sender, System.EventArgs e)
00159         {
00160             <span class="comment">// show the complete column</span>
00161             UpdateButton.Enabled = <span class="keyword">false</span>;
00162             CommitButton.Enabled = <span class="keyword">true</span>;
00163             CancelButton.Enabled = <span class="keyword">true</span>;
00164             DataGrid2.Columns[8].Visible = <span class="keyword">true</span>;
00165 
00166             <span class="comment">// set check boxes to checked, not checked or checked and disabled</span>
00167             foreach (DataGridItem item in DataGrid2.Items)
00168             {
00169                 CheckBox cb = (CheckBox)item.FindControl(<span class="stringliteral">"ApproveCheckBox"</span>);
00170                 <span class="keywordflow">if</span> (item.Cells[7].Text.Equals(TaskStatus.APPROVED))
00171                 {
00172                     cb.Checked = <span class="keyword">true</span>;
00173                     cb.Enabled = <span class="keyword">true</span>;
00174                 }
00175                 <span class="keywordflow">if</span> (item.Cells[7].Text.Equals(TaskStatus.COMPLETE))
00176                 {
00177                     cb.Checked = <span class="keyword">false</span>;
00178                     cb.Enabled = <span class="keyword">true</span>;
00179                 }
00180                 <span class="keywordflow">if</span> (item.Cells[7].Text.Equals(TaskStatus.INPROGRESS) )
00181                 {
00182                     cb.Checked = <span class="keyword">false</span>;
00183                     cb.Enabled = <span class="keyword">false</span>;
00184                 }
00185             }
00186         }
00187 
00188         <span class="keyword">private</span> <span class="keywordtype">void</span> CancelButton_Click(object sender, System.EventArgs e)
00189         {
00190             DataGrid2.Columns[8].Visible = <span class="keyword">false</span>;
00191             UpdateButton.Enabled = <span class="keyword">true</span>;
00192             CommitButton.Enabled = <span class="keyword">false</span>;
00193             CancelButton.Enabled = <span class="keyword">false</span>;
00194         }
00195 
00196         <span class="keyword">private</span> <span class="keywordtype">void</span> CommitButton_Click(object sender, System.EventArgs e)
00197         {
00198             DBDriver db = <span class="keyword">new</span> DBDriver();
00199 
00200             foreach (DataGridItem itm in DataGrid2.Items)
00201             {
00202                 CheckBox cb = (CheckBox)itm.FindControl(<span class="stringliteral">"ApproveCheckBox"</span>);
00203                 <span class="keywordflow">if</span>(cb.Enabled)
00204                 {
00205                     db.Query = 
00206                         <span class="stringliteral">"update tasks\n"</span>
00207                         + <span class="stringliteral">"set complete=@complete, actEndDate=@date\n"</span>
00208                         + <span class="stringliteral">"where id=@id;"</span>;
00209                     db.addParam(<span class="stringliteral">"@complete"</span>, cb.Checked?TaskStatus.APPROVED:TaskStatus.COMPLETE);
00210                     db.addParam(<span class="stringliteral">"@date"</span>, cb.Checked?Convert.ToString(DateTime.Now):"");
00211                     db.addParam(<span class="stringliteral">"@id"</span>, itm.Cells[1].Text);
00212                     db.nonQuery();
00213                 }
00214             }
00215             Server.Transfer(Request.Url.AbsolutePath);
00216         }
00217     }
00218 }
</pre></div><hr><address style="align: right;"><small>
Generated on Sat Aug 5 14:40:47 2006 for PMT by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.1 using KingsTools</small></address>
</body>
</html>

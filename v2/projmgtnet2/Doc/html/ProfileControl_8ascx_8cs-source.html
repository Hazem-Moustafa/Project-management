<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PMT: D:/My Documents/Visual Studio Projects/projmgtnet2/Controls/ProfileControl.ascx.cs Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.1 -->
<h1>D:/My Documents/Visual Studio Projects/projmgtnet2/Controls/ProfileControl.ascx.cs</h1><div class="fragment"><pre>00001 <span class="keyword">namespace </span>PMT.Controls
00002 {
00003     <span class="keyword">using</span> System;
00004     <span class="keyword">using</span> System.Data;
00005     <span class="keyword">using</span> System.Drawing;
00006     <span class="keyword">using</span> System.Web;
00007     <span class="keyword">using</span> System.Web.UI;
00008     <span class="keyword">using</span> System.Web.UI.WebControls;
00009     <span class="keyword">using</span> System.Web.UI.HtmlControls;
00010     <span class="keyword">using</span> System.Collections;
00011     <span class="keyword">using</span> PMTComponents;
00012 
00013     <span class="keyword">public</span> <span class="keyword">class </span>ProfileControl : UserControl
00014     {
00015         <span class="keyword">protected</span> RequiredFieldValidator SecurityRequiredFieldValidator;
00016         <span class="keyword">protected</span> DropDownList SecurityDropDownList;
00017         <span class="keyword">protected</span> RegularExpressionValidator EmailRegularExpressionValidator;
00018         <span class="keyword">protected</span> RequiredFieldValidator EmailRequiredFieldValidator;
00019         <span class="keyword">protected</span> TextBox EmailTextBox;
00020         <span class="keyword">protected</span> RegularExpressionValidator PhoneRegularExpressionValidator;
00021         <span class="keyword">protected</span> RequiredFieldValidator PhoneRequiredFieldValidator;
00022         <span class="keyword">protected</span> TextBox PhoneTextBox;
00023         <span class="keyword">protected</span> RegularExpressionValidator ZipRegularExpressionValidator;
00024         <span class="keyword">protected</span> RequiredFieldValidator ZipRequiredFieldValidator;
00025         <span class="keyword">protected</span> TextBox ZipTextBox;
00026         <span class="keyword">protected</span> RequiredFieldValidator StateRequiredFieldValidator;
00027         <span class="keyword">protected</span> TextBox StateTextBox;
00028         <span class="keyword">protected</span> RequiredFieldValidator CityRequiredFieldValidator;
00029         <span class="keyword">protected</span> TextBox CityTextBox;
00030         <span class="keyword">protected</span> RequiredFieldValidator AddressRequiredFieldValidator;
00031         <span class="keyword">protected</span> TextBox AddressTextBox;
00032         <span class="keyword">protected</span> CompareValidator PasswordCompareValidator;
00033         <span class="keyword">protected</span> RequiredFieldValidator Password2RequiredFieldValidator;
00034         <span class="keyword">protected</span> RequiredFieldValidator Password1RequiredFieldValidator;
00035         <span class="keyword">protected</span> RequiredFieldValidator UsernameRequiredFieldValidator;
00036         <span class="keyword">protected</span> RequiredFieldValidator LastNameRequiredFieldValidator;
00037         <span class="keyword">protected</span> TextBox LastNameTextBox;
00038         <span class="keyword">protected</span> RequiredFieldValidator FirstNameRequiredFieldValidator;
00039         <span class="keyword">protected</span> TextBox FirstNameTextBox;
00040         <span class="keyword">protected</span> TextBox OldPasswordTextBox;
00041         <span class="keyword">protected</span> RequiredFieldValidator OldPasswordRequiredFieldValidator;
00042         <span class="keyword">protected</span> Label NewPassword1Label;
00043         <span class="keyword">protected</span> Label NewPassword2Label;
00044         <span class="keyword">protected</span> TextBox UsernameTextBox;
00045         <span class="keyword">protected</span> Label OldPasswordLabel;
00046         <span class="keyword">protected</span> CheckBox ChangePasswordCheckBox;
00047         <span class="keyword">protected</span> TextBox NewPassword1TextBox;
00048         <span class="keyword">protected</span> TextBox NewPassword2TextBox;
00049         <span class="keyword">protected</span> Label FirstNameLabel;
00050         <span class="keyword">protected</span> Label LastNameLabel;
00051         <span class="keyword">protected</span> Label UsernamePromptLabel;
00052         <span class="keyword">protected</span> Label UsernameLabel;
00053         <span class="keyword">protected</span> Label AddressLabel;
00054         <span class="keyword">protected</span> Label CityLabel;
00055         <span class="keyword">protected</span> Label StateLabel;
00056         <span class="keyword">protected</span> Label ZipLabel;
00057         <span class="keyword">protected</span> Label PhoneLabel;
00058         <span class="keyword">protected</span> Label EmailLabel;
00059         <span class="keyword">protected</span> Label SecurityPromptLabel;
00060         <span class="keyword">protected</span> Label SecurityLabel;
00061         <span class="keyword">protected</span> ValidationSummary ValidationSummary1;
00062 
00063         <span class="keyword">private</span> <span class="keywordtype">void</span> Page_Load(object sender, System.EventArgs e)
00064         {
00065             <span class="comment">// Put user code to initialize the page here</span>
00066             <span class="keywordflow">if</span> (!<span class="keyword">this</span>.IsPostBack)
00067             {
00068                 SecurityDropDownList.DataSource = Enum.GetNames(typeof(PMTUserRole));
00069                 SecurityDropDownList.DataBind();
00070             }
00071         }
00072 
00073 <span class="preprocessor">        #region Profile Settings Properties</span>
00077 <span class="preprocessor">        public bool Editable</span>
00078 <span class="preprocessor"></span>        {
00079             set
00080             {
00081                 <span class="keyword">this</span>.FirstNameLabel.Visible = !value;
00082                 <span class="keyword">this</span>.FirstNameTextBox.Visible = value;
00083                 <span class="keyword">this</span>.FirstNameRequiredFieldValidator.Enabled = value;
00084 
00085                 <span class="keyword">this</span>.LastNameLabel.Visible = !value;
00086                 <span class="keyword">this</span>.LastNameTextBox.Visible = value;
00087                 <span class="keyword">this</span>.LastNameRequiredFieldValidator.Enabled = value;
00088 
00089                 <span class="keyword">this</span>.UsernameLabel.Visible = !value;
00090                 <span class="comment">//this.UsernamePromptLabel.Visible = value;</span>
00091                 <span class="keyword">this</span>.UsernameTextBox.Visible = value;
00092                 <span class="keyword">this</span>.UsernameRequiredFieldValidator.Enabled = value;
00093 
00094                 <span class="keyword">this</span>.AddressLabel.Visible = !value;
00095                 <span class="keyword">this</span>.AddressTextBox.Visible = value;
00096                 <span class="keyword">this</span>.AddressRequiredFieldValidator.Enabled = value;
00097 
00098                 <span class="keyword">this</span>.CityLabel.Visible = !value;
00099                 <span class="keyword">this</span>.CityTextBox.Visible = value;
00100                 <span class="keyword">this</span>.CityRequiredFieldValidator.Enabled = value;
00101 
00102                 <span class="keyword">this</span>.StateLabel.Visible = !value;
00103                 <span class="keyword">this</span>.StateTextBox.Visible = value;
00104                 <span class="keyword">this</span>.StateRequiredFieldValidator.Enabled = value;
00105 
00106                 <span class="keyword">this</span>.ZipLabel.Visible = !value;
00107                 <span class="keyword">this</span>.ZipTextBox.Visible = value;
00108                 <span class="keyword">this</span>.ZipRequiredFieldValidator.Enabled = value;
00109                 <span class="keyword">this</span>.ZipRegularExpressionValidator.Enabled = value;
00110 
00111                 <span class="keyword">this</span>.PhoneLabel.Visible = !value;
00112                 <span class="keyword">this</span>.PhoneTextBox.Visible = value;
00113                 <span class="keyword">this</span>.PhoneRequiredFieldValidator.Enabled = value;
00114                 <span class="keyword">this</span>.PhoneRegularExpressionValidator.Enabled = value;
00115 
00116                 <span class="keyword">this</span>.EmailLabel.Visible = !value;
00117                 <span class="keyword">this</span>.EmailTextBox.Visible = value;
00118                 <span class="keyword">this</span>.EmailRequiredFieldValidator.Enabled = value;
00119                 <span class="keyword">this</span>.EmailRegularExpressionValidator.Enabled = value;
00120 
00121                 <span class="keyword">this</span>.SecurityLabel.Visible = !value;
00122                 <span class="keyword">this</span>.SecurityDropDownList.Visible = value;
00123                 <span class="keyword">this</span>.SecurityRequiredFieldValidator.Enabled = value;
00124 
00125                 AllowChangeUsername = value;
00126                 AllowChangePassword = value;
00127                 AllowNewPassword = value;
00128                 AllowChangeSecurity = value;
00129             }
00130             get
00131             {   <span class="keywordflow">return</span> FirstNameTextBox.Visible;    }
00132         }
00133 
00137         <span class="keyword">public</span> <span class="keywordtype">bool</span> AllowChangeUsername
00138         {
00139             get
00140             {   <span class="keywordflow">return</span> UsernameTextBox.Visible; }
00141             set
00142             {
00143                 UsernameLabel.Visible = !value;
00144                 UsernameTextBox.Visible = value;
00145                 <span class="comment">//UsernamePromptLabel.Visible = value;</span>
00146                 UsernameRequiredFieldValidator.Enabled = value;
00147             }
00148         }
00149 
00153         <span class="keyword">public</span> <span class="keywordtype">bool</span> AllowChangePassword
00154         {
00155             get {   <span class="keywordflow">return</span> ChangePasswordCheckBox.Visible;    }
00156             set 
00157             {   
00158                 ChangePasswordCheckBox.Visible = value;
00159                 showChangePassword(<span class="keyword">false</span>); 
00160             }
00161         }
00162 
00166         <span class="keyword">public</span> <span class="keywordtype">bool</span> AllowNewPassword
00167         {
00168             get {   <span class="keywordflow">return</span> NewPassword1TextBox.Visible;    }
00169             set {   showNewPassword(value);         }
00170         }
00171 
00175         <span class="keyword">public</span> <span class="keywordtype">bool</span> AllowChangeSecurity
00176         {
00177             get {   <span class="keywordflow">return</span> SecurityPromptLabel.Visible;   }
00178             set
00179             {
00180                 SecurityLabel.Visible = !value;
00181                 <span class="comment">//SecurityPromptLabel.Visible = value;</span>
00182                 SecurityDropDownList.Visible = value;
00183                 SecurityRequiredFieldValidator.Enabled = value;
00184             }
00185         }
00186 
00190         <span class="keyword">public</span> <span class="keywordtype">bool</span> AdminView
00191         {
00192             set
00193             {
00194                 <span class="keywordflow">if</span> (value == <span class="keyword">true</span>)
00195                 {
00196                     AllowChangePassword = <span class="keyword">false</span>;
00197                     AllowNewPassword = <span class="keyword">true</span>;
00198                     AllowChangeSecurity = <span class="keyword">true</span>;
00199                     AllowChangeUsername = <span class="keyword">true</span>;
00200                     Password1RequiredFieldValidator.Enabled = <span class="keyword">false</span>;
00201                     Password2RequiredFieldValidator.Enabled = <span class="keyword">false</span>;
00202                 }
00203             }
00204         }
00205 <span class="preprocessor">        #endregion</span>
00206 <span class="preprocessor"></span>
00207 <span class="preprocessor">        #region Web Form Designer generated code</span>
00208 <span class="preprocessor"></span>        override <span class="keyword">protected</span> <span class="keywordtype">void</span> OnInit(EventArgs e)
00209         {
00210             <span class="comment">//</span>
00211             <span class="comment">// CODEGEN: This call is required by the ASP.NET Web Form Designer.</span>
00212             <span class="comment">//</span>
00213             InitializeComponent();
00214             base.OnInit(e);
00215         }
00216         
00221         <span class="keyword">private</span> <span class="keywordtype">void</span> InitializeComponent()
00222         {
00223             <span class="keyword">this</span>.ChangePasswordCheckBox.CheckedChanged += <span class="keyword">new</span> System.EventHandler(<span class="keyword">this</span>.ChangePasswordCheckBox_CheckedChanged);
00224             <span class="keyword">this</span>.Load += <span class="keyword">new</span> System.EventHandler(<span class="keyword">this</span>.Page_Load);
00225 
00226         }
00227 <span class="preprocessor">        #endregion</span>
00228 <span class="preprocessor"></span>
00232         <span class="keyword">private</span> <span class="keywordtype">void</span> ChangePasswordCheckBox_CheckedChanged(object sender, System.EventArgs e)
00233         {
00234             showChangePassword(ChangePasswordCheckBox.Checked);
00235         }
00236 
00241         <span class="keyword">private</span> <span class="keywordtype">void</span> showChangePassword(<span class="keywordtype">bool</span> val)
00242         {
00243             OldPasswordLabel.Visible = val;
00244             OldPasswordTextBox.Visible = val;
00245             OldPasswordRequiredFieldValidator.Enabled = val;
00246 
00247             <span class="keywordflow">if</span> (val == <span class="keyword">true</span>)
00248             {
00249                 NewPassword1Label.Text = <span class="stringliteral">"New Password:"</span>;
00250                 NewPassword2Label.Text = <span class="stringliteral">"Re-enter New Password:"</span>;
00251             }
00252             <span class="keywordflow">else</span>
00253             {
00254                 NewPassword1Label.Text = <span class="stringliteral">"Password:"</span>;
00255                 NewPassword2Label.Text = <span class="stringliteral">"Re-enter Password:"</span>;
00256             }
00257            
00258             showNewPassword(val);
00259         }
00260 
00265         <span class="keyword">private</span> <span class="keywordtype">void</span> showNewPassword(<span class="keywordtype">bool</span> val)
00266         {
00267             NewPassword1Label.Visible = val;
00268             NewPassword1TextBox.Visible = val;
00269             Password1RequiredFieldValidator.Enabled = val;
00270 
00271             NewPassword2Label.Visible = val;
00272             NewPassword2TextBox.Visible = val;
00273             Password2RequiredFieldValidator.Enabled = val;
00274         }
00275 
00280         <span class="keyword">public</span> <span class="keywordtype">void</span> fillForm(PMTUser user)
00281         {
00282             <span class="keyword">this</span>.FirstNameTextBox.Text = user.FirstName;
00283             <span class="keyword">this</span>.FirstNameLabel.Text   = user.FirstName;
00284             <span class="keyword">this</span>.LastNameTextBox.Text  = user.LastName;
00285             <span class="keyword">this</span>.LastNameLabel.Text    = user.LastName;
00286             <span class="keyword">this</span>.AddressTextBox.Text   = user.Address;
00287             <span class="keyword">this</span>.AddressLabel.Text     = user.Address;
00288             <span class="keyword">this</span>.CityTextBox.Text      = user.City;
00289             <span class="keyword">this</span>.CityLabel.Text        = user.City;
00290             <span class="keyword">this</span>.StateTextBox.Text     = user.State;
00291             <span class="keyword">this</span>.StateLabel.Text       = user.State;
00292             <span class="keyword">this</span>.ZipTextBox.Text       = user.ZipCode;
00293             <span class="keyword">this</span>.ZipLabel.Text         = user.ZipCode;
00294             <span class="keyword">this</span>.PhoneTextBox.Text     = user.PhoneNumber;
00295             <span class="keyword">this</span>.PhoneLabel.Text       = user.PhoneNumber;
00296             <span class="keyword">this</span>.EmailTextBox.Text     = user.Email;
00297             <span class="keyword">this</span>.EmailLabel.Text       = user.Email;
00298             <span class="keyword">this</span>.UsernameTextBox.Text  = user.UserName;
00299             <span class="keyword">this</span>.UsernameLabel.Text    = user.UserName;
00300 
00301             <span class="comment">// select the correct Security in the dropdown</span>
00302             SecurityDropDownList.SelectedIndex = (<span class="keywordtype">int</span>)user.Role;
00303             <span class="keyword">this</span>.SecurityLabel.Text = user.Role.ToString();
00304         }
00305 
00310         <span class="keyword">public</span> <span class="keywordtype">void</span> fillUser(PMTUser user)
00311         {
00312             user.UserName = <span class="keyword">this</span>.UsernameTextBox.Text;
00313             user.Address = <span class="keyword">this</span>.AddressTextBox.Text;
00314             user.City = <span class="keyword">this</span>.CityTextBox.Text;
00315             user.Email = <span class="keyword">this</span>.EmailTextBox.Text;
00316             user.FirstName = <span class="keyword">this</span>.FirstNameTextBox.Text;
00317             user.LastName = <span class="keyword">this</span>.LastNameTextBox.Text;
00318             user.PhoneNumber = <span class="keyword">this</span>.PhoneTextBox.Text;
00319             <span class="keywordflow">if</span>(<span class="keyword">this</span>.AllowChangeSecurity)
00320                 user.Role = (PMTUserRole)Enum.Parse(typeof(PMTUserRole), <span class="keyword">this</span>.SecurityDropDownList.SelectedItem.Text);
00321             user.State = <span class="keyword">this</span>.StateTextBox.Text;
00322             user.ZipCode = <span class="keyword">this</span>.ZipTextBox.Text;
00323             <span class="keywordflow">if</span> (NewPassword1TextBox.Text.Length &gt; 0)
00324                 user.Password = Encryption.encrypt(<span class="keyword">this</span>.NewPassword1TextBox.Text);
00325         }
00326 
00327 <span class="preprocessor">        #region User Properties</span>
00331 <span class="preprocessor">        public string Username </span>
00332 <span class="preprocessor"></span>        {
00333             get {   <span class="keywordflow">return</span> UsernameTextBox.Text;    }
00334         }
00338         <span class="keyword">public</span> string FirstName
00339         {
00340             get {   <span class="keywordflow">return</span> FirstNameTextBox.Text;   }
00341         }
00345         <span class="keyword">public</span> string LastName
00346         {
00347             get {   <span class="keywordflow">return</span> LastNameTextBox.Text;    }
00348         }
00352         <span class="keyword">public</span> string OldPassword
00353         {
00354             get {   <span class="keywordflow">return</span> OldPasswordTextBox.Text; }
00355         }
00359         <span class="keyword">public</span> string NewPassword1
00360         {
00361             get {   <span class="keywordflow">return</span> NewPassword1TextBox.Text;    }
00362         }
00366         <span class="keyword">public</span> string NewPassword2
00367         {
00368             get {   <span class="keywordflow">return</span> NewPassword2TextBox.Text;    }
00369         }
00373         <span class="keyword">public</span> string Address
00374         {
00375             get {   <span class="keywordflow">return</span> AddressTextBox.Text;    }
00376         }
00380         <span class="keyword">public</span> string City
00381         {
00382             get {   <span class="keywordflow">return</span> CityTextBox.Text;    }
00383         }
00387         <span class="keyword">public</span> string State
00388         {
00389             get {   <span class="keywordflow">return</span> StateTextBox.Text;    }
00390         }
00394         <span class="keyword">public</span> string Zip
00395         {
00396             get {   <span class="keywordflow">return</span> ZipTextBox.Text;    }
00397         }
00401         <span class="keyword">public</span> string Phone
00402         {
00403             get {   <span class="keywordflow">return</span> PhoneTextBox.Text;    }
00404         }
00408         <span class="keyword">public</span> string Email
00409         {
00410             get {   <span class="keywordflow">return</span> EmailTextBox.Text;    }
00411         }
00415         <span class="keyword">public</span> string Security
00416         {
00417             get {   <span class="keywordflow">return</span> SecurityDropDownList.SelectedItem.Text;    }
00418         }
00419 <span class="preprocessor">        #endregion</span>
00420 <span class="preprocessor"></span>    }
00421 }
</pre></div><hr><address style="align: right;"><small>
Generated on Sat Aug 5 14:40:47 2006 for PMT by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.1 using KingsTools</small></address>
</body>
</html>

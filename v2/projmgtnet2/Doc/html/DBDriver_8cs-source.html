<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PMT: DBDriver.cs Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.1 -->
<h1>DBDriver.cs</h1><div class="fragment"><pre>00001 <span class="keyword">using</span> System;
00002 <span class="keyword">using</span> System.Data;
00003 <span class="keyword">using</span> System.Data.SqlClient;
00004 <span class="keyword">using</span> System.Configuration;
00005 <span class="keyword">using</span> MySql;
00006 <span class="keyword">using</span> MySql.Data;
00007 <span class="keyword">using</span> MySql.Data.MySqlClient;
00008 
00009 <span class="keyword">namespace </span>PMT
00010 {
<a name="l00014"></a><a class="code" href="classPMT_1_1DBDriver.html">00014</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classPMT_1_1DBDriver.html">DBDriver</a>
00015     {
00016         <span class="comment">//private string connString;</span>
00017         <span class="comment">//private string user;</span>
00018         <span class="comment">//private string pwd;</span>
00019         <span class="keyword">private</span> MySqlConnection db;
00020         <span class="keyword">private</span> MySqlCommand cmd;
00021         <span class="keyword">private</span> string query;
00022         <span class="keyword">private</span> MySqlDataAdapter da;
00023         <span class="keyword">private</span> MySqlDataReader dr;
00024 
00028         <span class="keyword">public</span> string <a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDriver00">Query</a>
<a name="l00029"></a><a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDriver00">00029</a>         {
00030             get{<span class="keywordflow">return</span> query;}
00031             set
00032             {
00033                 <span class="comment">//to be added:query verification code</span>
00034                 <span class="comment">// change sql param escape char to mysql param escape char</span>
00035                 query = value.Replace(<span class="charliteral">'@'</span>, <span class="charliteral">'?'</span>); 
00036                 cmd = <span class="keyword">new</span> MySqlCommand(query,db);
00037             }
00038         }
00039 
00040         <span class="keyword">private</span> string ConnectionString
00041         {
00042             get {   <span class="keywordflow">return</span> ConfigurationSettings.AppSettings[<span class="stringliteral">"ConnectionString"</span>];   }
00043         }
00044 
<a name="l00048"></a><a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera0">00048</a>         <span class="keyword">public</span> <a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera0">DBDriver</a>()
00049         {
00050             <span class="comment">//set username and password</span>
00051             <span class="comment">//user="softeng4";</span>
00052             <span class="comment">//pwd="n3wF4ngl3d";</span>
00053             <span class="comment">//set the connection string</span>
00054             <span class="comment">//connString="Data Source=localhost;Database=softeng4;User ID='"+user+"';Password='"+pwd+"';";</span>
00055             <span class="comment">//open the connection  </span>
00056             db=<span class="keyword">new</span> MySqlConnection(<span class="keyword">this</span>.ConnectionString);
00057         }
<a name="l00062"></a><a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDriverd0">00062</a>         <a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDriverd0">~DBDriver</a>()
00063         {
00064             db.Close();
00065         }
00066 
<a name="l00070"></a><a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera1">00070</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera1">close</a>()
00071         {
00072             db.Close();
00073         }
00074 
<a name="l00079"></a><a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera2">00079</a>         <span class="keyword">public</span> MySqlDataAdapter <a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera2">createAdapter</a>()
00080         {
00081             db.Open();
00082             da=<span class="keyword">new</span> MySqlDataAdapter(cmd);
00083             db.Close();
00084             <span class="keywordflow">return</span> da;
00085         }
00086 
<a name="l00091"></a><a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera3">00091</a>         <span class="keyword">public</span> MySqlDataReader <a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera3">createReader</a>()
00092         {
00093             db.Open();
00094             dr=cmd.ExecuteReader();
00095             <span class="keywordflow">return</span> dr;
00096         }
00097 
<a name="l00101"></a><a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera4">00101</a>         <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera4">nonQuery</a>()
00102         {
00103             db.Open();
00104             <span class="keywordtype">int</span> ret=cmd.ExecuteNonQuery();
00105             db.Close();
00106             <span class="keywordflow">return</span> ret;
00107         }
00108 
<a name="l00113"></a><a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera5">00113</a>         <span class="keyword">public</span> object <a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera5">scalar</a>()
00114         {
00115             db.Open();
00116             object ret=cmd.ExecuteScalar();
00117             db.Close();
00118             
00119             <span class="keywordflow">return</span> ret;
00120         }
00121 
<a name="l00128"></a><a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera6">00128</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera6">addParam</a>(string pName, <span class="keywordtype">int</span> val)
00129         {
00130             <span class="comment">// replace sql param escape char with mysql param escape char</span>
00131             pName = pName.Replace(<span class="charliteral">'@'</span>, <span class="charliteral">'?'</span>);
00132             MySqlParameter param = <span class="keyword">new</span> MySqlParameter();
00133             param.DbType = DbType.Int32;
00134             param.ParameterName = pName;
00135             param.Value = val;
00136             cmd.Parameters.Add(param);
00137         }
00138 
<a name="l00145"></a><a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera7">00145</a>         <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classPMT_1_1DBDriver.html#PMT_1_1DBDrivera6">addParam</a>(string pName, string val)
00146         {
00147             <span class="comment">// replace sql param escape char with mysql param escape char</span>
00148             pName = pName.Replace(<span class="charliteral">'@'</span>, <span class="charliteral">'?'</span>);
00149             MySqlParameter param = <span class="keyword">new</span> MySqlParameter();
00150             param.DbType = DbType.String;
00151             param.ParameterName = pName;
00152             param.Value = val;
00153             cmd.Parameters.Add(param);
00154         }
00155     }
00156 }
</pre></div><hr><address style="align: right;"><small>
Generated on Sun Aug 6 23:06:02 2006 for PMT by <a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 width=110 height=53>
</a> 1.3.1 using KingsTools</small></address>
</body>
</html>
